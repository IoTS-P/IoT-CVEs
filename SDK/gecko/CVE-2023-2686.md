# CVE-2023-2686

Buffer overflow in Wi-Fi Commissioning MicriumOS example in Silicon Labs Gecko SDK v4.2.3 or earlier allows connected device to write payload onto the stack.

## Details

1. size comes from untrusted DHCP packet - [read size from DHCP](https://github.com/SiliconLabs/gecko_sdk/blob/gsdk_4.2/app/common/example/wifi_commissioning_micriumos/lwip_host/apps/dhcp_server.c#L181)
```c
size = pbuf_get_at(pbuf_in, index);
```
2. use large size to write ipaddr - [code](https://github.com/SiliconLabs/gecko_sdk/blob/gsdk_4.2/app/common/example/wifi_commissioning_micriumos/lwip_host/apps/dhcp_server.c#L183)
```c
// ipaddr is the destination
pbuf_copy_partial(pbuf_in, ipaddr, size, index);
```

3. ipaddr comes from stack-based variable `client_requested_addr` - [function call](https://github.com/SiliconLabs/gecko_sdk/blob/gsdk_4.2/app/common/example/wifi_commissioning_micriumos/lwip_host/apps/dhcp_server.c#L361) & [stack variable](https://github.com/SiliconLabs/gecko_sdk/blob/gsdk_4.2/app/common/example/wifi_commissioning_micriumos/lwip_host/apps/dhcp_server.c#L210)
```c
static void dhcpserver_fn() { 
...
uint32_t client_requested_addr = 0;
if (0 == dhcpserver_find_requested_ip(pbuf_in, (uint8_t *)&client_requested_addr)) 
...
}
```

## References

- [silabs document](https://community.silabs.com/sfc/servlet.shepherd/document/download/0698Y00000U2sFvQAJ?operationContext=S1)
- [source code](https://github.com/SiliconLabs/gecko_sdk/blob/gsdk_4.2/app/common/example/wifi_commissioning_micriumos/lwip_host/apps/dhcp_server.c)
